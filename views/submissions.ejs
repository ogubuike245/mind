<!DOCTYPE html>
<html>
  <%- include('./head.ejs') %>
  <body>
    <%- include('./navbar.ejs') %>
    <h1>SUBMIT DOCUMENT</h1>
    <h1><%= document._id %></h1>

    <form
      action="/api/v1/course/submission/document/<%= document._id %>/type/assignment"
      method="post"
      enctype="multipart/form-data"
    >
      <% if (isSubmitted) { %>
      <div>
        <input type="file" name="file" disabled />
      </div>
      <button type="submit" disabled>Already Submitted</button>
      <% } else { %>
      <input type="hidden" name="id" value="<%= document._id %>" />
      <div>
        <label for="file">FILE:</label>
        <input type="file" name="file" />
      </div>
      <button type="submit">Submit Document</button>
      <% } %>
    </form>

    <script>
      const form = document.querySelector("form");

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        try {
          const formData = new FormData(form);
          const response = await fetch(form.action, {
            method: form.method,
            body: formData,
          });
          const data = await response.json();
          if (data.success) {
            showToastifyNotification(
              "success",
              "Document Submitted successfully.",
              data.redirect
            );
            form.reset();
          } else {
            showToastifyNotification("error", data.error);
          }
        } catch (error) {
          console.log(error);
          showToastifyNotification("error", error);
        }
      });

      function showToastifyNotification(type, message, redirectUrl = null) {
        Toastify({
          text: message,
          duration: 3000,
          gravity: "top",
          position: "center",
          backgroundColor: type === "success" ? "#2ecc71" : "#e74c3c",
        }).showToast();

        if (type === "success" && redirectUrl) {
          setTimeout(() => {
            window.location.href = redirectUrl;
          }, 2000);
        }
      }
    </script>
  </body>
</html>
